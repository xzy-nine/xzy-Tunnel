# xzy-tunnel 浏览器扩展工作原理综述

## 客户端（浏览器扩展）原理

xzy-tunnel是一个为访问特定域名example.com端口然后转发的设计的浏览器扩展，其核心功能包括：

1. **域名检测与请求头修改**
   - 监控浏览器标签，识别特定域名的访问请求
   - 为识别到的目标域名请求添加特殊请求头 `xzytunnel`
   - 处理请求头

2. **端口信息处理**
   - 检测非特定端口URL（如 `https://example.com:8080`）
   - 尝试重定向到特定端口的URL（如 `https://example.com:1234`）
   - 同时保存原端口信息到请求头中，确保服务器端仍能接收到该信息

3. **缓存管理**
   - 提供针对特定域名的缓存清理功能
   - 通过 `chrome.browsingData.remove` API 实现定向清理

4. **连接识别**
   - 显示已检测到的连接列表（ID和名称）
   - 维护与连接状态

## 服务器端的原理


1. **端口路由系统**
   - 接收某端口的常规web访问,通过docker映射的设备的外部端口
   - 非标准端口可能对应NAS设备的不同服务或实例

2. **请求头识别机制**
   - 服务器对应端口检测带有 `xzytunnel` 请求头的流量
   - 从请求头中提取原始端口信息
   - 根据该信息将请求路由到正确的后端端口



## 整体工作流程

1. 用户尝试通过浏览器访问非特定端口的服务url
2. 扩展检测到访问，发起重定向并添加特殊请求头
3. 重定向后的请求发送到服务器
4. 服务器检查请求头，提取原始端口信息
5. 根据子域名和端口信息，服务器将请求路由到正确的本地服务
6. 设备处理请求并返回响应
